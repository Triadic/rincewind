<?php

require_once 'PHPUnit/Framework.php';

require_once dirname(__FILE__) . '/../../setup.php';

require_class('ProfilerTimer', 'Profiler');

/**
 * Test class for ProfilerTimer with fixed times.
 * Generated by PHPUnit on 2011-04-19 at 14:02:29.
 */
class ProfilerTimerFixedTest extends PHPUnit_Framework_TestCase {

  /**
   * @var ProfilerTimer
   */
  protected $profilerTimer;

  protected $startTime = 1000.0;
  /**
   * Sets up the fixture, for example, opens a network connection.
   * This method is called before a test is executed.
   */
  protected function setUp() {
    $this->profilerTimer = new ProfilerTimer('Text context', 'Section name', $this->startTime);
  }

  /**
   * Tears down the fixture, for example, closes a network connection.
   * This method is called after a test is executed.
   */
  protected function tearDown() {
    
  }
  /**
   * @covers ProfilerTimer::__construct
   * @covers ProfilerTimer::getSection
   */
  public function testConstructorSetsSection() {
    self::assertSame('Section name', $this->profilerTimer->getSection());
  }
  /**
   * @covers ProfilerTimer::__construct
   * @covers ProfilerTimer::getStartTime
   */
  public function testConstructorSetsStartTime() {
    self::assertEquals($this->startTime, $this->profilerTimer->getStartTime());
  }

  /**
   * @covers ProfilerTimer::end
   * @covers ProfilerTimer::getEndTime
   */
  public function testEnd() {
    $this->profilerTimer->end($this->startTime + 100.5);
    self::assertEquals($this->startTime + 100.5, $this->profilerTimer->getEndTime());
  }

  /**
   * @covers ProfilerTimer::end
   * @covers ProfilerTimer::getDuration
   */
  public function testEndSetsDuration() {
    $this->profilerTimer->end($this->startTime + 100.5);
    self::assertEquals(100.5, $this->profilerTimer->getDuration());
  }
  
  /**
   * @covers ProfilerTimer::getDuration
   */
  public function testGetDurationReturnsNullIfNotFinished() {
    self::assertNull($this->profilerTimer->getDuration());
  }

  /**
   * @covers ProfilerTimer::isPaused
   * @covers ProfilerTimer::getPauseStartTime
   */
  public function testIsPaused() {
    self::assertSame(false, $this->profilerTimer->isPaused());
    self::assertNull($this->profilerTimer->getPauseStartTime());
    $this->profilerTimer->pause($this->startTime + 50.5);
    self::assertSame(true, $this->profilerTimer->isPaused());
  }

  /**
   * @covers ProfilerTimer::pause
   */
  public function testPauseSetsPauseStartTime() {
    $this->profilerTimer->pause($this->startTime + 50.5);
    self::assertEquals($this->startTime + 50.5, $this->profilerTimer->getPauseStartTime());
  }

  /**
   * @covers ProfilerTimer::resume
   */
  public function testResume() {
    $this->profilerTimer->pause($this->startTime + 50.5);
    self::assertSame(true, $this->profilerTimer->isPaused());
    $this->profilerTimer->resume($this->startTime + 99.5);
    self::assertSame(false, $this->profilerTimer->isPaused());
    self::assertNull($this->profilerTimer->getPauseStartTime());
  }

  /**
   * @covers ProfilerTimer::getTotalPauseDuration
   */
  public function testGetTotalPauseDuration() {
    $this->profilerTimer->pause($this->startTime + 50.5);
    $this->profilerTimer->resume($this->startTime + 99.5);
    self::assertEquals(49.0, $this->profilerTimer->getTotalPauseDuration());
    $this->profilerTimer->pause($this->startTime + 200);
    $this->profilerTimer->resume($this->startTime + 201);
    self::assertGreaterThanOrEqual(50, $this->profilerTimer->getTotalPauseDuration());
  }

  /**
   * @covers ProfilerTimer::pause
   */
  public function testPauseDoesNothingIfAlreadyPaused() {
    $this->profilerTimer->pause($this->startTime + 10);
    $firstPausetime = $this->profilerTimer->getPauseStartTime();
    $this->profilerTimer->pause($this->startTime + 20);
    self::assertSame($firstPausetime, $this->profilerTimer->getPauseStartTime());
  }

  
  /**
   * @covers ProfilerTimer::getDuration
   */
  public function testGetTotalDurationSubstractsPause() {
    $this->profilerTimer->pause($this->startTime + 10);
    $this->profilerTimer->resume($this->startTime + 20);
    $this->profilerTimer->end($this->startTime + 30);
    self::assertEquals(20, $this->profilerTimer->getDuration());
  }
  
  /**
   * @covers ProfilerTimer::end
   */
  public function testEndResumesTimerFirst() {
    $this->profilerTimer->pause($this->startTime + 10);
    self::assertTrue($this->profilerTimer->isPaused());
    $this->profilerTimer->end($this->startTime + 20);
    self::assertFalse($this->profilerTimer->isPaused());
  }

}
