<?php

require_once 'PHPUnit/Framework.php';

require_once dirname(__FILE__) . '/../../setup.php';

require_class('Profile', 'Profiler');
require_class('Profiler', 'Profiler');


/**
 * Test class for Profile.
 * Generated by PHPUnit on 2011-04-19 at 17:05:15.
 */
class ProfileTest extends PHPUnit_Framework_TestCase {

  /**
   * @var Profiler
   */
  protected $profiler;
  
  /**
   * Sets up the fixture, for example, opens a network connection.
   * This method is called before a test is executed.
   */
  protected function setUp() {
    $this->profiler = $this->getMock('Profiler', array('start', 'stop'));
    Profile::setProfiler($this->profiler);
  }

  /**
   * Tears down the fixture, for example, closes a network connection.
   * This method is called after a test is executed.
   */
  protected function tearDown() {
    
  }

  /**
   * @covers Profile::setProfiler
   * @covers Profile::getProfiler
   */
  public function testSetAndGetProfiler() {
    self::assertSame($this->profiler, Profile::getProfiler());
  }

  /**
   * @covers Profile::start
   */
  public function testStart() {
    $this->profiler->expects($this->once())->method('start')->with('context_x', 'section_x');
    Profile::start('context_x', 'section_x');
  }

  /**
   * @covers Profile::start
   */
  public function testStartWithoutSection() {
    $this->profiler->expects($this->once())->method('start')->with('context_x', null);
    Profile::start('context_x');
  }
  
  /**
   * @covers Profile::stop
   */
  public function testStop() {
    $this->profiler->expects($this->once())->method('stop');
    Profile::stop();
  }


}
